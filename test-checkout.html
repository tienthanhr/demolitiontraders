<!DOCTYPE html>
<html>
<head>
    <title>Test Checkout API</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .result { background: white; padding: 20px; margin: 10px 0; border-radius: 5px; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; white-space: pre-wrap; }
        button { padding: 10px 20px; background: #2f3192; color: white; border: none; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>Test Checkout API</h1>
    
    <button onclick="addToCart()">1. Add Product to Cart</button>
    <button onclick="viewCart()">2. View Cart</button>
    <button onclick="createOrder()">3. Create Order</button>
    
    <div id="result"></div>
    
    <script>
        async function addToCart() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Adding product to cart...</p>';
            
            try {
                // Add product ID 1 to cart
                const response = await fetch('/demolitiontraders/api/cart/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        product_id: 1,
                        quantity: 2
                    })
                });
                
                const text = await response.text();
                console.log('Add to cart response:', text);
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <h3>Add to Cart Result</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <pre>${text}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        async function viewCart() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Loading cart...</p>';
            
            try {
                const response = await fetch('/demolitiontraders/api/cart/get');
                const text = await response.text();
                console.log('Cart response:', text);
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <h3>Cart Contents</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <pre>${text}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
            }
        }
        
        async function createOrder() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>Creating order...</p>';
            
            const orderData = {
                email: 'test@example.com',
                billing_address: {
                    first_name: 'John',
                    last_name: 'Doe',
                    email: 'test@example.com',
                    phone: '021234567',
                    address: '123 Test Street',
                    city: 'Auckland',
                    postcode: '1010'
                },
                shipping_address: {
                    first_name: 'John',
                    last_name: 'Doe',
                    address: '123 Test Street',
                    city: 'Auckland',
                    postcode: '1010'
                },
                payment_method: 'credit_card',
                notes: 'Test order',
                shipping_amount: 0,
                discount_amount: 0
            };
            
            try {
                console.log('Sending order data:', orderData);
                
                const response = await fetch('/demolitiontraders/api/orders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);
                
                const text = await response.text();
                console.log('Response text:', text);
                console.log('Response text length:', text.length);
                
                resultDiv.innerHTML = `
                    <div class="result">
                        <h3>Create Order Result</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Content-Type:</strong> ${response.headers.get('content-type')}</p>
                        <p><strong>Length:</strong> ${text.length} bytes</p>
                        <h4>Response:</h4>
                        <pre>${text}</pre>
                    </div>
                `;
                
                // Try to parse as JSON
                try {
                    const json = JSON.parse(text);
                    resultDiv.innerHTML += `
                        <div class="result">
                            <h4>Parsed JSON:</h4>
                            <pre>${JSON.stringify(json, null, 2)}</pre>
                        </div>
                    `;
                } catch (e) {
                    resultDiv.innerHTML += `
                        <div class="result" style="border-left: 4px solid red;">
                            <h4>JSON Parse Error:</h4>
                            <p style="color: red;">${e.message}</p>
                            <p>The response is not valid JSON.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = `
                    <div class="result" style="border-left: 4px solid red;">
                        <p style="color: red;"><strong>Error:</strong> ${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
